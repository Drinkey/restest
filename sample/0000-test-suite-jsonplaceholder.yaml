includes:
  - env.yaml
  - datasets.yaml

assertions:
  - http_status_code
  - valid_json
  - contains_text
  - contains_field
  - contains_dict
  - matches

actions:
  - request
  - readfile
  - execute

variables:
  url: "{base_url}/post"

testsuite:
  description: post API Test
  setup: 
    - all_tokens
  teardown:
    - logout()

  testcases:
    - name: Create post Success - HTTP 201
      do:
        method: post
        url: url
        dataset: ds_file_exception_code_201
      expect:
        - http_status_code: 201
        - valid_json
        - contains_text: ['create success', 'id=2000']

    - name: Create post failed - HTTP 401
      variables:
        - api: /post
      do:
        - action: readfile
          path: /etc/sshd_config
        - method: post
          dataset: ds_file_exception_code_401
      expect:
        - http_status_code: 200
        - contains_dict: {'err_msg': "not a vaild number"}

    - name: Update a post success - HTTP 201
      do:
        - action: readfile
          path: f"~/.ssh/known_host"
        - method: put
          resp: responses
        - action: execute
          cmd: f"ls {responses}"
      expect:
        - http_201
        - valid_json
        - contains: ['string1', 'str2']

    # - name: pet API Delete success - HTTP 201
    #   request:
    #     method: delete
    #     data: data_set_4
    #   expect:
    #     - http_201
    #     - valid_json
    #     - contains_text: ['deleted']